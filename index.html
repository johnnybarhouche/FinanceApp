<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Credit Card Dues Tracker</title>
<style>
:root { --bg:#fff; --card:#f9f9f9; --text:#000; --muted:#666; --accent:#007aff; --ok:#34c759; --danger:#ff3b30; --chip:#0f1722; --chipText:#e6edf3; }
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{overflow-x:hidden}
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text)}
.wrap{max-width:800px;margin:0 auto;padding:16px}

h1{font-size:22px;margin:0 0 12px;text-align:center}
.card{background:var(--card);border-radius:12px;padding:12px;margin-bottom:16px;box-shadow:0 2px 5px rgba(0,0,0,.08)}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
label{font-size:14px;color:var(--muted)}
input,button{border-radius:10px;border:1px solid #d0d5dd;padding:10px 12px;font-size:16px}
input[type=month]{width:160px}
button{background:var(--accent);color:#fff;border:none;cursor:pointer}
button.secondary{background:#e5e7eb;color:#111}
button:active{opacity:.85}

/* Totals chips in one line */
.totals{display:flex;gap:8px;align-items:center;flex-wrap:wrap;justify-content:space-between;margin-top:10px}
.totals .chips{display:flex;gap:8px;flex-wrap:wrap}
.chip{background:var(--chip);color:var(--chipText);border-radius:999px;padding:6px 10px;font-weight:700;font-size:14px}

/* Table base */
table{width:100%;border-collapse:separate;border-spacing:0 8px;margin-top:8px}
th,td{text-align:left;padding:8px;font-size:14px}
th{color:var(--muted);font-weight:600}
tr{background:#fff;border:1px solid #ececec}
tr td:first-child{border-top-left-radius:8px;border-bottom-left-radius:8px}
tr td:last-child{border-top-right-radius:8px;border-bottom-right-radius:8px}
.pill{font-size:12px;padding:4px 8px;border-radius:999px;color:#fff;white-space:nowrap}
.paid{background:var(--ok)}
.due{background:var(--danger)}

/* Make inputs fit cells nicely */
td input[type=number], td input[type=date]{width:100%;min-width:0}

/* Compact action button */
.table-btn{background:#eef2ff;color:#111;border:1px solid #c7d2fe;padding:6px 10px;border-radius:8px}

/* Mobile-first responsive stack for rows */
@media (max-width: 480px){
  thead{display:none}
  table, tbody, tr, td {display:block;width:100%}
  tr{padding:8px;border-radius:10px}
  td{padding:6px 6px}
  td::before{content:attr(data-label);display:block;color:var(--muted);font-size:12px;margin-bottom:4px}
  /* Put status and action side-by-side on mobile */
  td.actions{display:flex;gap:8px;align-items:center}
  .wrap{padding-left:12px;padding-right:12px}
}

/* Prevent any accidental horizontal scroll */
img,table,div,section{max-width:100%}
</style>
</head>
<body>
<div class="wrap">
  <h1>ðŸ’³ Credit Card Dues Tracker</h1>

  <div class="card">
    <div class="row" style="justify-content:space-between">
      <div class="row">
        <label for="month">Month</label>
        <input type="month" id="month" />
      </div>
      <div class="row">
        <button class="secondary" id="btnPrev" aria-label="Previous month">â—€</button>
        <button class="secondary" id="btnNext" aria-label="Next month">â–¶</button>
        <button id="btnAddPayment">Add Payment</button>
        <button class="secondary" id="btnMarkAllPaid">Mark All Paid</button>
      </div>
    </div>

    <table>
      <thead>
        <tr><th>Card</th><th>Amount</th><th>Due Date</th><th>Status</th><th>Action</th></tr>
      </thead>
      <tbody id="paymentsTbody"></tbody>
    </table>

    <div class="totals">
      <div class="chips">
        <span class="chip" id="chipTotal">Total: 0</span>
        <span class="chip" id="chipPaid">Paid: 0</span>
        <span class="chip" id="chipRemain">Remaining: 0</span>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="row" style="margin-bottom:8px"><strong>Cards</strong></div>
    <div class="row">
      <input id="ccName" placeholder="Card name" />
      <input id="ccLast4" placeholder="Last 4" maxlength="4" />
      <input id="ccLimit" type="number" placeholder="Limit" />
      <button id="btnAddCard">Add</button>
    </div>
    <div id="cardsList" style="margin-top:8px"></div>
  </div>

  <div class="card">
    <div class="row" style="justify-content:space-between">
      <div class="row"><strong>Data</strong></div>
      <div class="row" style="gap:8px">
        <button id="btnExport">Export CSV</button>
        <button id="btnReset" style="background:var(--danger)">Reset</button>
      </div>
    </div>
  </div>
</div>

<script>
const STORE_KEY='ccapp_v4';
const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
let store; try{store=JSON.parse(localStorage.getItem(STORE_KEY)||'{"cards":[],"payments":{}}')}catch(e){store={cards:[],payments:{}}}
const ym = d=>`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`; // local, no UTC drift
const fmt0 = n=> String(Math.round(+n||0));
function save(){localStorage.setItem(STORE_KEY,JSON.stringify(store));}
function ensureMonth(m){if(!store.payments[m]) store.payments[m] = {};}

function render(){
  const m=$('#month').value; ensureMonth(m);
  const tb=$('#paymentsTbody'); tb.innerHTML='';
  let total=0, paid=0;
  store.cards.forEach(c=>{
    if(!store.payments[m][c.id]) store.payments[m][c.id]={amount:'',dueDate:'',paid:false};
    const p=store.payments[m][c.id];
    total += +p.amount||0; if(p.paid) paid += +p.amount||0;
    const tr=document.createElement('tr');
    tr.innerHTML=
      `<td data-label="Card">${escapeHtml(c.name)}${c.last4?` â€¢â€¢â€¢â€¢ ${escapeHtml(c.last4)}`:''}</td>
       <td data-label="Amount"><input type="number" inputmode="decimal" step="0.01" data-amount="${c.id}" value="${p.amount}"></td>
       <td data-label="Due Date"><input type="date" data-date="${c.id}" value="${p.dueDate||''}"></td>
       <td data-label="Status">${p.paid?'<span class="pill paid">Paid</span>':'<span class="pill due">Unpaid</span>'}</td>
       <td data-label="Action" class="actions"><button class="table-btn" data-togglepaid="${c.id}">${p.paid?'Unmark':'Mark Paid'}</button></td>`;
    tb.appendChild(tr);
  });
  $('#chipTotal').textContent = `Total: ${fmt0(total)}`;
  $('#chipPaid').textContent = `Paid: ${fmt0(paid)}`;
  $('#chipRemain').textContent = `Remaining: ${fmt0(total-paid)}`;

  $$('input[data-amount]').forEach(inp=> inp.onchange=e=>{
    const m=$('#month').value;const id=e.target.dataset.amount;ensureMonth(m);
    store.payments[m][id].amount=+e.target.value||0; save(); render();
  });
  $$('input[data-date]').forEach(inp=> inp.onchange=e=>{
    const m=$('#month').value;const id=e.target.dataset.date;ensureMonth(m);
    store.payments[m][id].dueDate=e.target.value; save(); render();
  });
  $$('button[data-togglepaid]').forEach(btn=> btn.onclick=e=>{
    const m=$('#month').value; const id=e.target.dataset.togglepaid;
    store.payments[m][id].paid=!store.payments[m][id].paid; save(); render();
  });
}

function shiftMonth(delta){
  const val=$('#month').value; let y,m,base;
  if(val && /^\d{4}-\d{2}$/.test(val)){[y,m]=val.split('-').map(Number); base=new Date(y,m-1,1);} else {base=new Date(); base.setDate(1);} 
  base.setMonth(base.getMonth()+delta);
  $('#month').value = ym(base); render();
}

$('#btnPrev').onclick=()=>shiftMonth(-1);
$('#btnNext').onclick=()=>shiftMonth(1);
$('#btnAddCard').onclick=()=>{
  const name=$('#ccName').value.trim(); if(!name) return alert('Enter card name');
  const last4=$('#ccLast4').value.trim(); const limit=$('#ccLimit').value.trim();
  store.cards.push({id:Date.now().toString(36)+Math.random().toString(36).slice(2,7),name,last4,limit}); save();
  $('#ccName').value=''; $('#ccLast4').value=''; $('#ccLimit').value=''; render();
};
$('#btnAddPayment').onclick=()=>{
  if(store.cards.length===0) return alert('Add a card first.');
  const m=$('#month').value; ensureMonth(m);
  const target=store.cards[0]; const cur=store.payments[m][target.id]||{};
  const amt=prompt(`Amount due for ${target.name} (${m})`, cur.amount??''); if(amt===null) return;
  const due=prompt('Due date (YYYY-MM-DD)', cur.dueDate??'');
  store.payments[m][target.id] = {amount:+amt||0, dueDate:due||'', paid:false}; save(); render();
};
$('#btnMarkAllPaid').onclick=()=>{
  const m=$('#month').value; ensureMonth(m);
  if(!confirm('Mark all visible payments as PAID?')) return;
  Object.keys(store.payments[m]).forEach(id=> store.payments[m][id].paid=true); save(); render();
};
$('#btnExport').onclick=()=>{
  const m=$('#month').value; ensureMonth(m);
  const rows=[["month","card","last4","amount","due_date","paid"]];
  store.cards.forEach(c=>{const p=store.payments[m][c.id]||{amount:'',dueDate:'',paid:false};
    rows.push([m,c.name,c.last4||'',String(p.amount||''),p.dueDate||'',p.paid?'yes':'no']);
  });
  const csv=rows.map(r=>r.map(v=>'"'+String(v).replace(/"/g,'""')+'"').join(',')).join('\n');
  const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv'})); a.download=`ccapp-${m}.csv`; a.click();
};
$('#btnReset').onclick=()=>{ if(confirm('Reset all?')){ store={cards:[],payments:{}}; save(); render(); } };

function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m])); }

(function init(){ const d=new Date(); d.setDate(1); $('#month').value=ym(d); render(); })();
</script>
</body>
</html>
