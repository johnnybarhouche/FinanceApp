<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Credit Card Dues Tracker</title>
  <style>
    :root { --bg:#0b0f14; --panel:#101823; --card:#131f2c; --text:#e6edf3; --muted:#9aa7b5; --accent:#4f46e5; --ok:#22c55e; --warn:#f59e0b; --danger:#ef4444; }
    *{box-sizing:border-box; -webkit-tap-highlight-color:transparent}
    html,body{overflow-x:hidden}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--text)}
    .wrap{max-width:1100px;margin:24px auto;padding:0 12px}
    h1{font-size:22px;margin:0 0 12px;text-align:center}

    .card{background:var(--card);border-radius:14px;padding:14px;box-shadow:0 6px 20px rgba(0,0,0,.25);margin-bottom:14px}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    label{font-size:12px;color:var(--muted)}
    input,button{border-radius:10px;border:1px solid #223247;background:#0f1722;color:var(--text);padding:10px 12px;font-size:16px}
    button{border:1px solid #2a3b57;cursor:pointer}
    button.primary{background:var(--accent);border-color:transparent}
    button.ghost{background:transparent}

    .table-wrap{overflow-x:auto}
    table{width:100%;min-width:700px;border-collapse:separate;border-spacing:0 8px;margin-top:8px}
    th,td{padding:8px 10px;text-align:left;font-size:14px}
    th{color:var(--muted);font-weight:600}
    tr{background:#0f1824}
    tr td:first-child, tr th:first-child{border-top-left-radius:10px;border-bottom-left-radius:10px}
    tr td:last-child, tr th:last-child{border-top-right-radius:10px;border-bottom-right-radius:10px}
    .pill{font-size:12px;padding:4px 8px;border-radius:999px;white-space:nowrap}
    .pill.due{background:#1a2432;color:#f8fafc;border:1px solid #2b3b55}
    .pill.paid{background:#0f2a1a;border:1px solid #1f5c3b;color:#c7f9d4}

    .totals{display:flex;gap:8px;justify-content:flex-end;align-items:center;margin-top:10px;flex-wrap:wrap}
    .chip{background:#0f1722;border:1px solid #20314d;color:#e6edf3;border-radius:999px;padding:6px 10px;font-weight:700;font-size:14px}

    .month-controls{display:flex;gap:8px;align-items:center}
    .spacer{flex:1}

    @media (max-width: 480px){
      .wrap{padding:0 8px}
      input[type="month"]{width:170px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ðŸ’³ Credit Card Dues Tracker</h1>

    <div class="card">
      <div class="row" style="justify-content:space-between">
        <div class="month-controls">
          <label for="month">Month</label>
          <input type="month" id="month" />
          <button class="ghost" id="btnPrev" title="Previous month">â—€</button>
          <button class="ghost" id="btnNext" title="Next month">â–¶</button>
        </div>
        <div class="row">
          <button class="primary" id="btnAddPayment">Add Payment</button>
          <button id="btnMarkAllPaid">Mark All Paid</button>
        </div>
      </div>

      <div class="table-wrap">
        <table>
          <thead>
            <tr><th>Card</th><th>Amount</th><th>Due Date</th><th>Status</th><th></th></tr>
          </thead>
          <tbody id="paymentsTbody"></tbody>
        </table>
      </div>

      <div class="totals">
        <span class="chip" id="chipTotal">Total: 0</span>
        <span class="chip" id="chipPaid">Paid: 0</span>
        <span class="chip" id="chipRemain">Remaining: 0</span>
      </div>
    </div>

    <div class="card">
      <div class="row">
        <input id="ccName" placeholder="Card name" />
        <input id="ccLast4" placeholder="Last 4" maxlength="4" />
        <input id="ccLimit" type="number" placeholder="Limit" />
        <button class="primary" id="btnAddCard">Add</button>
      </div>
      <div id="cardsList" style="margin-top:10px"></div>
    </div>

    <div class="card">
      <div class="row" style="justify-content:space-between">
        <div class="row"><label>Data</label></div>
        <div class="row" style="gap:8px">
          <button id="btnExport">Export CSV</button>
          <button id="btnReset" class="ghost" style="border-color:#3a2230;color:#ffb4c0">Reset</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const STORE_KEY='ccapp_v5';
    const $ = s=>document.querySelector(s); const $$ = s=>Array.from(document.querySelectorAll(s));
    let store; try{ store = JSON.parse(localStorage.getItem(STORE_KEY)||'{"cards":[],"payments":{}}') }catch(e){ store={cards:[],payments:{}} }

    const ym = d => `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`; // local (no UTC drift)
    const todayYM = ym(new Date());
    const fmt0 = n => String(Math.round(+n||0)); // whole numbers for totals

    function save(){ localStorage.setItem(STORE_KEY, JSON.stringify(store)); }
    function ensureMonth(m){ if(!store.payments[m]) store.payments[m] = {}; }

    function render(){
      const m = $('#month').value; ensureMonth(m);
      const tb = $('#paymentsTbody'); tb.innerHTML='';
      let total=0, paid=0;
      store.cards.forEach(c=>{
        if(!store.payments[m][c.id]) store.payments[m][c.id] = {amount:'', dueDate:'', paid:false};
        const p = store.payments[m][c.id];
        total += +p.amount||0; if(p.paid) paid += +p.amount||0;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${escapeHtml(c.name)}${c.last4?` â€¢â€¢â€¢â€¢ ${escapeHtml(c.last4)}`:''}</td>
          <td><input type="number" inputmode="decimal" step="0.01" data-amount="${c.id}" value="${p.amount}" placeholder="0" style="width:120px" /></td>
          <td><input type="date" data-date="${c.id}" value="${p.dueDate||''}" style="width:150px" /></td>
          <td>${p.paid?'<span class="pill paid">Paid</span>':'<span class="pill due">Unpaid</span>'}</td>
          <td><button class="ghost" data-togglepaid="${c.id}">${p.paid?'Unmark':'Mark Paid'}</button></td>`;
        tb.appendChild(tr);
      });
      $('#chipTotal').textContent = `Total: ${fmt0(total)}`;
      $('#chipPaid').textContent = `Paid: ${fmt0(paid)}`;
      $('#chipRemain').textContent = `Remaining: ${fmt0(total-paid)}`;

      $$('input[data-amount]').forEach(inp=> inp.onchange=e=>{
        const m=$('#month').value; const id=e.target.dataset.amount; ensureMonth(m);
        store.payments[m][id].amount = +e.target.value||0; save(); render();
      });
      $$('input[data-date]').forEach(inp=> inp.onchange=e=>{
        const m=$('#month').value; const id=e.target.dataset.date; ensureMonth(m);
        store.payments[m][id].dueDate = e.target.value; save(); render();
      });
      $$('button[data-togglepaid]').forEach(btn=> btn.onclick=e=>{
        const m=$('#month').value; const id=e.target.dataset.togglepaid; ensureMonth(m);
        store.payments[m][id].paid = !store.payments[m][id].paid; save(); render();
      });
    }

    // Actions
    $('#btnAddCard').onclick=()=>{
      const name=$('#ccName').value.trim(); if(!name) return alert('Enter card name');
      const last4=$('#ccLast4').value.trim(); const limit = $('#ccLimit').value.trim();
      store.cards.push({id:Date.now().toString(36)+Math.random().toString(36).slice(2,7), name, last4, limit});
      save(); $('#ccName').value=''; $('#ccLast4').value=''; $('#ccLimit').value=''; render();
    };

    function shiftMonth(delta){
      const val = $('#month').value; let base;
      if(val && /^\d{4}-\d{2}$/.test(val)) base = new Date(val+'-01T00:00:00'); else { base = new Date(); base.setDate(1); }
      base.setDate(1); base.setMonth(base.getMonth()+delta);
      $('#month').value = ym(base); render();
    }
    $('#btnPrev').onclick=()=>shiftMonth(-1);
    $('#btnNext').onclick=()=>shiftMonth(1);

    $('#btnAddPayment').onclick=()=>{
      if(store.cards.length===0) return alert('Add a card first.');
      const m=$('#month').value; ensureMonth(m);
      const target=store.cards[0]; const cur=store.payments[m][target.id]||{};
      const amt=prompt(`Amount due for ${target.name} (${m})`, cur.amount??''); if(amt===null) return;
      const due=prompt('Due date (YYYY-MM-DD)', cur.dueDate??'');
      store.payments[m][target.id] = {amount:+amt||0, dueDate:due||'', paid:false}; save(); render();
    };

    $('#btnMarkAllPaid').onclick=()=>{
      const m=$('#month').value; ensureMonth(m);
      if(!confirm('Mark all visible payments as PAID?')) return;
      Object.keys(store.payments[m]).forEach(id=> store.payments[m][id].paid=true); save(); render();
    };

    $('#btnExport').onclick=()=>{
      const m=$('#month').value; ensureMonth(m);
      const rows=[["month","card","last4","amount","due_date","paid"]];
      store.cards.forEach(c=>{ const p=store.payments[m][c.id]||{amount:'',dueDate:'',paid:false};
        rows.push([m,c.name,c.last4||'',String(p.amount||''),p.dueDate||'',p.paid?'yes':'no']);
      });
      const csv=rows.map(r=>r.map(v=>'"'+String(v).replace(/"/g,'""')+'"').join(',')).join('\n');
      const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv'})); a.download=`ccapp-${m}.csv`; a.click();
    };

    $('#btnReset').onclick=()=>{ if(confirm('Reset ALL data?')){ store={cards:[],payments:{}}; save(); render(); } };

    function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m])); }

    // Init
    (function init(){ const d=new Date(); d.setDate(1); $('#month').value=ym(d); render(); })();
  </script>
</body>
</html>
